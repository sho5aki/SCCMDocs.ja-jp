---
title: "バックアップと回復 | System Center Configuration Manager"
description: "System Center Configuration Manager でサイトをバックアップする方法と、障害が発生したときやデータが損失したときにサイトを回復する方法について説明します。"
ms.custom: na
ms.date: 10/06/2016
ms.prod: configuration-manager
ms.reviewer: na
ms.suite: na
ms.technology:
- configmgr-other
ms.tgt_pltfrm: na
ms.topic: article
ms.assetid: f7832d83-9ae2-4530-8a77-790e0845e12f
caps.latest.revision: 22
author: Brenduns
ms.author: brenduns
manager: angrobe
translationtype: Human Translation
ms.sourcegitcommit: 1134bb2f04152288e72d40b1b1083f415cb4e900
ms.openlocfilehash: d02dc47b2a9010d035ceecbbc6bf3d544f4dc1f4


---
# <a name="backup-and-recovery-for-system-center-configuration-manager"></a>System Center Configuration Manager のバックアップと回復

*適用対象: System Center Configuration Manager (Current Branch)*

データの損失を防ぐためにバックアップと回復方法を準備します。 Configuration Manager サイトのバックアップと回復方法は、データの損失を最小限に抑え、サイトと階層をより迅速に回復するのに役立ちます。 このトピックのセクションは、サイトをバックアップする場合と、障害が発生したときやデータが損失したときにサイトを回復する場合に役立ちます。  

-   [Configuration Manager サイトのバックアップ](#BKMK_SiteBackup)  

    -   [バックアップ メンテナンス タスク](#BKMK_BackupMaintenanceTask)  

    -   [Data Protection Manager を使用したサイト データベースのバックアップ](#BKMK_DPMBackup)  

    -   [バックアップ スナップショットのアーカイブ](#BKMK_ArchivingBackupSnapshot)  

    -   [AfterBackup.bat ファイルの使用](#BKMK_UsingAfterBackup)  

    -   [その他のバックアップ タスク](#BKMK_SupplementalBackup)  

-   [Configuration Manager サイトの回復](#BKMK_RecoverSite)  

    -   [回復オプションの検討](#BKMK_DetermineRecoveryOptions)  

        -   [サイト サーバーの回復オプション](#BKMK_SiteServerRecoveryOptions)  

        -   [サイト データベースの回復オプション](#BKMK_SiteDatabaseRecoveryOption)  

        -   [SQL Server の変更の追跡の保有期間](#bkmk_SQLretention)  

        -   [サイトのデータまたはグローバル データの再初期化プロセス](#bkmk_reinit)  

        -   [サイト データベースの回復方法](#BKMK_SiteDBRecoveryScenarios)  

    -   [サイトの無人回復スクリプト ファイルのキー](#BKMK_UnattendedSiteRecoveryKeys)  

    -   [回復後の作業](#BKMK_PostRecovery)  

    -   [セカンダリ サイトの回復](#BKMK_RecoverSecondarySite)  

-   [SMS ライター サービス](#BKMK_SMSWriterService)  

> [!NOTE]  
>  SQL Server AlwaysOn 可用性グループを使用してサイト データベースをホストする場合は、「[System Center Configuration Manager の高可用性サイト データベースの SQL Server AlwaysOn](../../core/servers/deploy/configure/sql-server-alwayson-for-a-highly-available-site-database.md#bkmk_BnR)」トピックの「[SQL Server AlwaysOn 可用性グループを使用するときのバックアップと回復の変更](../../core/servers/deploy/configure/sql-server-alwayson-for-a-highly-available-site-database.md)」セクションの説明に従って、バックアップと回復の計画を変更します。  

##  <a name="a-namebkmksitebackupa-back-up-a-configuration-manager-site"></a><a name="BKMK_SiteBackup"></a> Configuration Manager サイトのバックアップ  
 Configuration Manager には、次の処理を実行するバックアップ メンテナンス タスクが用意されています。  

-   スケジュールに従って実行する  

-   サイト データベースのバックアップを作成する  

-   特定のレジストリ キーのバックアップを作成する  

-   特定のフォルダーとファイルのバックアップを作成する  

-   **CD.Latest** フォルダーをバックアップする ([「System Center Configuration Manager の CD.Latest フォルダー」](../../core/servers/manage/the-cd.latest-folder.md)」をご覧ください)  

 既定のサイト バックアップ タスクを少なくとも 5 日ごとに実行するように計画を立ててください。 これは、Configuration Manager で使用される [SQL Server の変更の追跡の保有期間](#bkmk_SQLretention)が 5 日間であるためです。  

 バックアップ プロセスを簡略化するには、**AfterBackup.bat** ファイルを作成して、このバックアップ メンテナンス タスクが正常に実行された時点で自動的にバックアップ後処理が実行されるようにします。 通常、AfterBackup.bat ファイルは、バックアップのスナップショットを安全な場所にアーカイブするために使用します。 AfterBackup.bat ファイルは、バックアップ フォルダーにファイルをコピーしたり、その他のバックアップ タスクを開始するときにも使用できます。

以下のセクションは、Configuration Manager のバックアップ戦略を立てる場合に役立ちます。  

> [!NOTE]  
>  Configuration Manager では、Configuration Manager のバックアップ メンテナンス タスク、または別のプロセスで作成したサイト データベース バックアップからサイト データベースを回復できます。 たとえば、Microsoft SQL Server のメンテナンス プランの一環として作成されたバックアップから、サイト データベースを復元することができます。 System Center 2012 Data Protection Manager (DPM) を使用して作成されたバックアップからサイト データベースを復元できます。 詳細については、「 [Data Protection Manager を使用したサイト データベースのバックアップ](#BKMK_DPMBackup)」をご覧ください。  

###  <a name="a-namebkmkbackupmaintenancetaska-backup-maintenance-task"></a><a name="BKMK_BackupMaintenanceTask"></a> バックアップ メンテナンス タスク  
 Configuration Manager サイトのバックアップは、定義済みのサイト サーバーのバックアップ メンテナンス タスクをスケジュール設定することで自動化できます。 中央管理サイトとプライマリ サイトをバックアップすることはできますが、セカンダリ サイトやサイト システム サーバーのバックアップはサポートされていません。 Configuration Manager のバックアップ サービスは、バックアップ コントロール ファイル (**<ConfigMgrInstallationFolder\>\Inboxes\Smsbkup.box\Smsbkup.ctl**) で定義されている指示に従って実行されます。 このバックアップ コントロール ファイルを変更して、バックアップ サービス動作を変更することができます。 サイトのバックアップ状態に関する情報は、 **Smsbkup.log** ファイルに書き込まれます。 このファイルは、サイト サーバーのバックアップ メンテナンス タスクのプロパティで指定した、バックアップ先フォルダーに保存されます。  


##### <a name="to-enable-the-site-backup-maintenance-task"></a>サイトのバックアップ メンテナンス タスクを有効にするには  

1.  Configuration Manager コンソールで、**[管理]** > **[サイトの構成]**  

     \>**[サイト]** の順に開きます。  

2.  バックアップ メンテナンス タスクを有効にしたいサイトを選択します。  

3.  **[ホーム]** タブの **[設定]** グループで、**[サイトのメンテナンス タスク]** を選択します。  

4.  **[サイト サーバーのバックアップ]**  >  **[編集]** の順に選択します。  

5.  **[このタスクを有効にする]** > **[パスの設定]** の順に選択してバックアップ先を指定します。 次のオプションがあります。  

    > [!IMPORTANT]  
    >  バックアップ ファイルの改ざんを防ぐため、ファイルを安全な場所に保存してください。 最も安全なバックアップ パスは、フォルダーに NTFS ファイル システムのアクセス許可を設定できるローカル ドライブです。 Configuration Manager では、バックアップ パスに保存されたバックアップ データは暗号化されません。  

    -   **サイト データおよびデータベース用のサイト サーバーのローカル ドライブ**: サイト サーバーのローカル ディスク ドライブの指定したパスに、サイトとサイト データベースのバックアップ ファイルが保存されるようにします。 バックアップ タスクを実行する前に、ローカル フォルダーを作成する必要があります。   サイト サーバーのローカル システム アカウントが、サイト サーバーのバックアップ先フォルダーへの NTFS **書き込み** 権限を持っている必要があります。 SQL Server を実行しているコンピューターのローカル システム アカウントが、サイト データベースのバックアップ先フォルダーへの NTFS **書き込み** 権限を持っている必要があります。  

    -   **サイト データおよびデータベース用のネットワーク パス (UNC 名)**: 指定した UNC パスに、サイトとサイト データベースのバックアップ ファイルが保存されるようにします。 バックアップ タスクを実行する前に、共有を作成する必要があります。SQL Server が別のコンピューターにインストールされている場合は、サイト サーバーのコンピューター アカウントと SQL Server のコンピューター アカウントが、共有ネットワーク フォルダーの NTFS **書き込み** 権限と共有権限を持っている必要があります。  

    -   **サイト サーバーおよび SQL Server のローカル ドライブ**: サイト サーバーのバックアップ ファイルが、サイト サーバーのローカル ドライブの指定したパスに保存され、サイト データベースのバックアップ ファイルが、サイト データベース サーバーのローカル ドライブの指定したパスに保存されるようにします。 バックアップ タスクを実行する前に、ローカル フォルダーを作成する必要があります。 サイト サーバーのコンピューター アカウントが、サイト サーバーに作成するフォルダーの NTFS **書き込み** 権限を持っている必要があります。 SQL Server のコンピューター アカウントが、サイト データベース サーバーに作成するフォルダーの NTFS **書き込み** 権限を持っている必要があります。 このオプションは、サイト データベースがサイト サーバーにインストールされていない場合のみ選択できます。  

    > [!NOTE]  
    >    - バックアップ先を参照できるのは、UNC パスを指定した場合だけです。

    >- バックアップ先フォルダー名や共有名に Unicode 文字を含めることはできません。  


6.  サイトのバックアップ タスクのスケジュールを構成します。 ベスト プラクティスとして、営業時間外に実行することをお勧めします。 階層構造がある場合は、サイトの障害発生に備え、データの保管期間が長くなるように、少なくとも 1 週間に 2 回実行するスケジュールを設定してください。  

    バックアップを構成しているのと同じサイト サーバーで Configuration Manager コンソールを実行する場合は、サイト サーバーのバックアップ メンテナンス タスクのスケジュールでローカル時間が使用されます。 バックアップを構成しているサイトから離れたコンピューターから Configuration Manager コンソールが実行されている場合は、サイト サーバーのバックアップ メンテナンス タスクのスケジュールで UTC が使用されます。  

7.  サイト バックアップ タスクが失敗した場合にアラートを作成するかどうかを選択し、**[OK]** をクリックしてから　**[OK]** をクリックします。 選択した場合は、Configuration Manager がバックアップ エラーに関する重大なアラートを作成したときに、**[監視]** ワークスペースの **[アラート]** ノードで確認できます。  

 次に、サイト サーバーのバックアップ メンテナンス タスクが実行されており、バックアップが作成されることを確認します。  

##### <a name="to-verify-that-the-backup-site-server-maintenance-task-is-running"></a>サイト サーバーのバックアップ メンテナンス タスクが実行されていることを確認するには  

-   次のいずれかの操作を行って、サイト サーバーのバックアップ メンテナンス タスクが実行されていることを確認します。  

    -   タスクで作成したバックアップ先フォルダーにあるファイルのタイムスタンプを確認します。 タイムスタンプが、タスクのスケジュールされた前回の実行日時と同じ日時で更新されていることを確認します。  

    -   [ **監視** ] ワークスペースの [ **コンポーネントのステータス** ] ノードで、SMS_SITE_BACKUP のステータス メッセージを確認します。 サイトのバックアップが問題なく完了している場合は、ID 5035 のメッセージが表示されているはずです。  

    -   バックアップが失敗したら警告を生成するようにサイト サーバーのバックアップ メンテナンス タスクが構成されている場合は、[ **監視** ] ワークスペースの [ **アラート** ] ノードでバックアップ エラーを確認できます。  

    -   <*ConfigMgrInstallationFolder*>\Logs にある Smsbkup.log で警告やエラーを確認します。 サイトのバックアップが問題なく完了している場合は、メッセージ ID " `Backup completed` " の " `STATMSG: ID=5035`" というメッセージとタイムスタンプが表示されているはずです。  

    > [!TIP]  
    >  サイト サーバーのバックアップ メンテナンス タスクが正常に実行されなかった場合は、SMS_SITE_BACKUP サービスを停止してから、再開してみてください。  

###  <a name="a-namebkmkdpmbackupa-using-data-protection-manager-to-back-up-your-site-database"></a><a name="BKMK_DPMBackup"></a> Data Protection Manager を使用したサイト データベースのバックアップ  
 System Center 2012 Data Protection Manager (DPM) を使用してサイト データベースをバックアップできます。 DPM でサイト データベース コンピューターの新しい保護グループを作成する必要があります。 新しい保護グループの作成ウィザードの [ **グループ メンバーの選択** ] ページで、データ ソース一覧から SMS ライター サービスを選択してから、該当するメンバーとしてサイト データベースを選択します。 DPM を使用したサイト データベースのバックアップの詳細については、TechNet の「 [Data Protection Manager](http://go.microsoft.com/fwlink/?LinkId=272772) 」ドキュメント ライブラリを参照してください。  

> [!IMPORTANT]  
>  Configuration Manager では、名前付きインスタンスを使用する SQL Server クラスターの DPM バックアップはサポートしていませんが、SQL Server の既定インスタンスを使用する SQL Server クラスターの DPM バックアップはサポートしています。  

 サイト データベースを復元したら、セットアップの手順に従ってサイトを回復します。 Data Protection Manager で回復したサイト データベースを使用するには、**[手動で回復したサイト データベースを使用する]** 回復オプションを選択します。  

###  <a name="a-namebkmkarchivingbackupsnapshota-archiving-the-backup-snapshot"></a><a name="BKMK_ArchivingBackupSnapshot"></a> バックアップ スナップショットのアーカイブ  
 サイト サーバーのバックアップ メンテナンス タスクを初めて実行するときに、障害が発生したサイト サーバーの復元に使用できるバックアップ スナップショットが作成されます。 その後、スケジュールに従って、バックアップ タスクが実行されると、新しいバックアップ スナップショットが作成され、前のスナップショットが上書きされます。 つまり、サイトのバックアップ スナップショットは 1 つだけになります。それより前のスナップショットに戻すことはできません。  

 しかし、次のような状況を考慮して、バックアップ スナップショットを複数アーカイブしておくことをお勧めします。  

-   バックアップ メディアに障害が発生したり、紛失したりすることはよくあります。また、部分的にしかバックアップが格納されていない場合もあります。 障害が発生したスタンドアロンのプライマリ サイトは、バックアップがまったくない状態で復元するよりも、古いバックアップから復元する方が手間がかかりません。 階層にあるサイトの場合は、SQL Server の変更の追跡の保有期間内のバックアップでなければなりません。それ以外は必要ありません。  

-   サイト内の破損が検出されないまま、バックアップ サイクルが何回か繰り返される可能性があります。 そのため、サイトが破損する前のバックアップ スナップショットを使用する必要がある場合があります。 これは、スタンドアロンのプライマリ サイトと、SQL Server の変更の追跡の保有期間内にバックアップしている階層内のサイトに当てはまります。  

-   サイトのバックアップ スナップショットがまったくない状態になる可能性があります。 たとえば、サイト サーバーのバックアップ タスクは現在のデータのバックアップを開始する前に以前のバックアップ スナップショットを削除するので、タスクが正常に実行されなかった場合は、有効なバックアップ スナップショットがなくなります。  

###  <a name="a-namebkmkusingafterbackupa-using-the-afterbackupbat-file"></a><a name="BKMK_UsingAfterBackup"></a> AfterBackup.bat ファイルの使用  
 サイト サーバーのバックアップ タスクでサイトが正常にバックアップされると、AfterBackup.bat というファイルが自動的に実行されます。 この AfterBackup.bat ファイルは、手動で作成して <*ConfigMgrInstallationFolder*>\Inboxes\Smsbkup に保存しておく必要があります。 AfterBackup.bat ファイルが存在し、正しいフォルダーに保存されている場合、バックアップ タスクの完了後に、このファイルが自動的に実行されます。 AfterBackup.bat を使って、バックアップが完了するたびにバックアップ スナップショットがアーカイブされるようにしたり、サイト サーバーのバックアップ メンテナンス タスクに含まれていない後処理が自動的に行われるようにすることができます。 前者の場合は、AfterBackup.bat でアーカイブ処理とバックアップ処理を統合することにより、常に新しいバックアップ スナップショットがアーカイブされるようにします。 AfterBackup.bat ファイルが存在しない場合は、バックアップ タスクでその実行がスキップされます。バックアップ処理自体には、何も影響ありません。 サイト バックアップ タスクによって AfterBackup.bat ファイルが正常に実行されたことを確認するには、[ **監視** ] ワークスペースの [ **コンポーネントのステータス** ] ノードを参照して、SMS_SITE_BACKUP のステータス メッセージを確認します。 AfterBackup.bat コマンド ファイルの実行が正常に開始された場合は、ID 5040 の付いたメッセージが表示されているはずです。  

> [!TIP]  
>  サイト サーバーのバックアップ ファイルをアーカイブする AfterBackup.bat ファイルを作成するには、バッチ ファイルで、Robocopy などのコピー コマンド ツールを使用する必要があります。 たとえば、AfterBackup.bat ファイルを作成して、1 行目に `Robocopy E:\ConfigMgr_Backup \\ServerName\ShareName\ConfigMgr_Backup /MIR`と記述します。 Robocopy の詳細については、「 [Robocopy](http://go.microsoft.com/fwlink/p/?LinkId=228408) 」のコマンド ライン リファレンスを参照してください。  

 AfterBackup.bat を使用する本来の目的は、バックアップ スナップショットをアーカイブすることですが、バックアップするたびに何らかの後処理を行うための AfterBackup.bat を作成することもできます。  

###  <a name="a-namebkmksupplementalbackupa-supplemental-backup-tasks"></a><a name="BKMK_SupplementalBackup"></a> その他のバックアップ タスク  
 サイト サーバーのバックアップ メンテナンス タスクによって、サイト サーバー ファイルとサイト データベースのバックアップ スナップショットが作成されますが、この他にも、バックアップすることを検討した方がよい項目があります。 以下のセクションは、Configuration Manager のバックアップ戦略を立てる場合に役立ちます。  

#### <a name="back-up-custom-reporting-services-reports"></a>Reporting Services のカスタム レポートのバックアップ  
 Reporting Services の定義済みのレポートを変更した場合や、カスタム レポートを作成した場合は、レポート サーバー データベース ファイルのバックアップを取ることが重要です。 レポート サーバーのバックアップには、レポートとモデルのソース ファイル、暗号化キー、カスタム アセンブリや拡張機能、構成ファイル、カスタム レポートで使用する SQL Server カスタム ビュー、カスタム ストアード プロシージャなどが含まれていなければなりません。  

> [!IMPORTANT]  
>  Configuration Manager を新しいバージョンにアップグレードすると、定義済みのレポートが新しいレポートで上書きされる可能性があります。 定義済みレポートを変更した場合は、レポートのバックアップを作成した後、Reporting Services で復元してください。  

 Reporting Services のカスタム レポートのバックアップの詳細については、SQL Server 2014 Books Online の「 [Reporting Services インストールのバックアップおよび復元操作](https://technet.microsoft.com/library/ms155814\(v=sql.120\).aspx) 」を参照してください。  

#### <a name="backup-content-files"></a>コンテンツ ファイルのバックアップ  
 Configuration Manager のコンテンツ ライブラリは、ソフトウェア更新プログラム、アプリケーション、オペレーティング システムの展開などで使用するコンテンツ ファイルがすべて保管されている場所です。 コンテンツ ライブラリは、サイト サーバーと各配布ポイントにあります。 サイト サーバーのバックアップ メンテナンス タスクでは、コンテンツ ライブラリのファイルやパッケージ ソース ファイルはバックアップされません。 サイト サーバーで障害が発生したときに、コンテンツ ライブラリのファイルに関する情報は、サイト データベースに復元されますが、コンテンツ ライブラリのファイルとパッケージ ソース ファイルはサイト サーバーに手動で復元する必要があります。  

-   **コンテンツ ライブラリ**: コンテンツ ライブラリを復元してからでないと、配布ポイントにコンテンツを再配布することはできません。 コンテンツの再配布を開始すると、Configuration Manager によって、サイト サーバーにあるコンテンツ ライブラリから配布ポイントにファイルがコピーされます。 サイト サーバーのコンテンツ ライブラリは SCCMContentLib フォルダーにあります。このフォルダーは、通常、サイトがインストールされた時点で空きディスク領域が最も大きかったドライブにあります。  

-   **パッケージのソース ファイル**: パッケージのソース ファイルを復元してからでないと、配布ポイントのコンテンツを更新することはできません。 コンテンツの更新を開始すると、Configuration Manager によって、パッケージ ソースから新しいファイルや変更されたファイルがコンテンツ ライブラリにコピーされ、次に、関連する配布ポイントにコピーされます。 すべてのパッケージとアプリケーションのパッケージ ソースの場所を見つけるには、SQL Server で `SELECT * FROM v_Package`というクエリを実行します。 パッケージ ID の先頭の 3 文字を見ると、パッケージ ソースのサイトがわかります。 たとえば、CEN00001 というパッケージ ID では、CEN がソース サイトのサイト コードです。 パッケージのソース ファイルを復元するときは、障害発生前と同じ場所に復元する必要があります。  

 サイト サーバーのファイル システムのバックアップに、コンテンツ ライブラリとパッケージ ソースの両方の場所を含めていることを確認してください。  

#### <a name="back-up-custom-software-updates"></a>カスタム ソフトウェア更新プログラムのバックアップ  
     System Center Updates Publisher 2011 is a stand-alone tool that lets you publish custom software updates to Windows Server Update Services (WSUS), synchronize the software updates to Configuration Manager, assess software updates compliance, and deploy the custom software updates to clients. Updates Publisher uses a local database for its software update repository. When you use Updates Publisher to manage custom software updates, determine whether you have to include the Updates Publisher database in your backup plan. For more information about Updates Publisher, see [System Center Updates Publisher 2011](http://go.microsoft.com/fwlink/p/?LinkId=228726) in the System Center TechCenter Library.  

 次の手順に従って、Updates Publisher データベースをバックアップします。  

###### <a name="to-back-up-the-updates-publisher-2011-database"></a>Updates Publisher 2011 データベースをバックアップするには  

1.  Updates Publisher を実行しているコンピューターで、%*USERPROFILE*%\AppData\Local\Microsoft\System Center Updates Publisher 2011\5.00.1727.0000\\ の Updates Publisher データベース ファイル (Scupdb.sdf) を見つけます。 Updates Publisher を実行するユーザーごとに異なるデータベース ファイルがあります。  

2.  データベース ファイルをバックアップ先にコピーします。 たとえば、バックアップ先が E:\ConfigMgr_Backup の場合は、Updates Publisher データベース ファイルを E:\ConfigMgr_Backup\SCUP2011 にコピーします。  

    > [!TIP]  
    >  コンピューターにデータベース ファイルが複数ある場合は、データベース ファイルに関連付けられているユーザー プロファイルを示すサブフォルダーにファイルを保存することを検討してください。 たとえば、E:\ConfigMgr_Backup\SCUP2011\User1 というサブフォルダーと E:\ConfigMgr_Backup\SCUP2011\User2 というサブフォルダーに、それぞれ該当するデータベース ファイルを保存します。  

### <a name="user-state-migration-data"></a>ユーザー状態の移行データ  
 オペレーティング システムを展開するときに、現在のオペレーティング システムのユーザー状態を維持したい場合は、Configuration Manager のタスク シーケンスを使用し、ユーザー状態データをキャプチャして復元できます。 ユーザー状態データを格納しているフォルダーは、状態移行ポイントのプロパティに一覧されます。 このユーザー状態の移行データは、サイト サーバーのバックアップ メンテナンス タスクでバックアップされません。 そのため、ユーザー状態の移行データを格納するように指定したフォルダーを手動でバックアップする必要があります。   

##### <a name="to-determine-the-folders-used-to-store-user-state-migration-data"></a>ユーザー状態の移行データを格納しているフォルダーを確認するには  

1.  Configuration Manager コンソールで、[ **管理**] をクリックします。  

2.  **[管理]** ワークスペースで、**[サイトの構成]** を展開して **[サーバーとサイト システムの役割]** を選択します。  

3.  状態移行の役割をホストするサイト システムを選択し、**[サイト システムの役割]** で **[状態移行ポイント]** を選択します。  

4.  **[サイトの役割** ] タブの **[プロパティ]** グループで、 **[プロパティ]**をクリックします。  

5.  ユーザー状態移行データが保存されているフォルダーが [ **全般** ] タブの [ **フォルダーの詳細** ] セクションに一覧表示されます。  

##  <a name="a-namebkmkrecoversitea-recover-a-configuration-manager-site"></a><a name="BKMK_RecoverSite"></a> Configuration Manager サイトの回復  
 Configuration Manager サイトで障害が発生した場合や、サイト データベースのデータが損失した場合は、Configuration Manager サイトの回復が必要です。 サイトの回復の中心となる作業は、データの修復と同期です。これは、業務の中断を防ぐためにも必要な作業です。  

> [!IMPORTANT]  
>  サイトのデータベースを回復する場合:  
>   
>  -   同じバージョンおよびエディションの SQL Server を使用する必要があります。 たとえば、SQL Server 2012 で実行したデータベースを SQL Server 2014 に復元することはできません。 同様に、SQL Server 2014 の Standard エディションで実行していたサイト データベースを SQL Server 2014 の Enterprise エディションに復元することはできません。  
> -   SQL Server を **シングル ユーザー モード**に設定しないでください。  
> -   MDF ファイルと LDF ファイルが有効であることを確認します。 サイトを回復するとき、復元するファイルの状態のチェックは行われません。  


 サイトの回復を開始するには、CD.Latest フォルダーから Configuration Manager セットアップ ウィザードを実行します。  無人インストール スクリプトを構成し、Setup コマンドの **/script** オプションを使用して、同じ CD.Latest フォルダーからセットアップを実行することもできます。 使用できる回復オプションは、Configuration Manager サイト データベースのバックアップがあるかどうかによって異なります。 詳細については、[「System Center Configuration Manager の CD.Latest フォルダー」](../../core/servers/manage/the-cd.latest-folder.md)」をご覧ください。  

> [!IMPORTANT]  
>  サイト サーバーの **[スタート]** メニューから Configuration Manager セットアップを実行する場合は、**[サイトを回復する]** オプションは使用できません。  
>   
>  Configuration Manager コンソール内から更新プログラムをインストールした後で、バックアップを作成した場合は、インストール メディアのセットアップまたは Configuration Manager のインストール パスを使用してサイトを正常に再インストールすることはできません。  

> [!NOTE]  
>  データベースのレプリカ用に構成されたサイト データベースを復元した後で、データベースのレプリカを使用するためには、データベースの各レプリカを再構成して、パブリケーションとサブスクリプションの両方を再作成する必要があります。  

###  <a name="a-namebkmkdeterminerecoveryoptionsa-determine-your-recovery-options"></a><a name="BKMK_DetermineRecoveryOptions"></a> 回復オプションの検討  
 Configuration Manager のプライマリ サイト サーバーと中央管理サイトの回復を検討するときには、サイト サーバーとサイト データベースという 2 つの要素を考慮する必要があります。 どのオプションを選択するかを決めるときに、次のセクションを参考にしてください。  

> [!NOTE]  
>  前に回復できなかったサイトや、完全にインストールされていないサイトを回復する場合は、まず、セットアップで **[Configuration Manager をアンインストールする]** オプションを選択しないと、サイトを回復するオプションを選択することはできません。 アンインストールしようとしているサイトに子サイトがある場合は、**[Configuration Manager をアンインストールする]** オプションを選択する前に、アンインストールするサイトのサイト データベースを手動で削除する必要があります。削除しないと、アンインストールが正常に完了しません。  

####  <a name="a-namebkmksiteserverrecoveryoptionsa-site-server-recovery-options"></a><a name="BKMK_SiteServerRecoveryOptions"></a> サイト サーバーの回復オプション  
 Configuration Manager インストール フォルダーの外に作成する CD.Latest フォルダーのコピーから、セットアップを開始する必要があります。 その後、 **[サイトを回復する]** オプションを選択します。 セットアップを実行したときに、選択できる回復オプションは次のとおりです。  

-   **既存のバックアップを使用してこのサイト サーバーを回復する**: サイトで障害が発生する前に、**サイト サーバーのバックアップ** メンテナンス タスクの一環としてサイト サーバーに作成された Configuration Manager サイト サーバーをバックアップしている場合に、このオプションを使用します。 サイトが再インストールされ、バックアップされているサイトに基づいて、サイト設定が構成されます。  

-   **このサイト サーバーを再インストールする**: サイト サーバーのバックアップがない場合に、このオプションを選択します。 サイト サーバーが再インストールされますが、初めてインストールしたときと同じようにして、サイト設定を指定する必要があります。 必ず、サイトを初めてインストールしたときと同じサイト コードとサイト データベース名を使ってください。  

> [!NOTE]  
>  セットアップにより、サーバーで既存の Configuration Manager サイトが検出された場合、サイトの回復を開始できますが、サイト サーバーの回復オプションが限られます。 たとえば、既存のサイト サーバーでセットアップを実行した場合は、サイト データベース サーバーは回復できますが、サイト サーバーの回復オプションは無効になっています。  

####  <a name="a-namebkmksitedatabaserecoveryoptiona-site-database-recovery-options"></a><a name="BKMK_SiteDatabaseRecoveryOption"></a> サイト データベースの回復オプション  
 セットアップを実行するときに、次のサイト データベースの回復オプションを選択できます。  

-   **バックアップ セットを使用してサイト データベースを復元する**: サイト データベースで障害が発生する前に、**サイト サーバーのバックアップ** メンテナンス タスクで Configuration Manager サイト データベースをバックアップしている場合に、このオプションを使用します。 階層構造がある場合は、サイト データベースの最後のバックアップ以後に加えられた変更が、中央管理サイト (プライマリ サイトを回復するとき)、または基準プライマリ サイト (中央管理サイトを回復するとき) から取得されます。 スタンドアロンのプライマリ サイトのサイト データベースを回復する場合は、最後のバックアップ以後にサイトに加えられた変更を回復することはできません。  

     階層内のサイトのサイト データベースを回復するときは、そのサイトが中央管理サイトとプライマリ サイトのどちらであるかと、最後のバックアップが SQL Server の変更の追跡の保有期間内に作成されたかどうかによって、回復方法が異なります。 詳細については、このトピックの [「サイト データベースの回復方法」](#BKMK_SiteDBRecoveryScenarios) セクションを参照してください。  

    > [!NOTE]  
    >  サイト データベースが存在するのに、バックアップ セットを使用してサイト データベースを回復するオプションを選択した場合は、正常に回復できません。  

-   **このサイトの新しいデータベースを作成する**: Configuration Manager サイト データベースのバックアップがない場合に、このオプションを使用します。 階層構造がある場合は、新しいデータベースが作成され、プライマリ サイトの回復用には、中央管理サイトからレプリケートされたデータが使われ、中央管理サイトの回復用には、基準プライマリ サイトからレプリケートされたデータが使われます。 スタンドアロンのプライマリ サイトを回復する場合や、プライマリ サイトのない中央管理サイトを回復する場合は、このオプションを選択することはできません。  

-   **手動で回復したサイト データベースを使用する**: Configuration Manager サイト データベースを既に回復しているが、回復プロセスを完了する必要がある場合に、このオプションを使用します。 Configuration Manager では、Configuration Manager のバックアップ メンテナンス タスク、または DPM や別のプロセスを使用して実行したサイト データベース バックアップからサイト データベースを回復できます。 Configuration Manager 以外の方法を使用してサイト データベースを復元した場合は、サイト データベースの回復を完了するために、セットアップを実行して、このオプションを選択する必要があります。 階層構造がある場合は、サイト データベースの最後のバックアップ以後に加えられた変更が、中央管理サイト (プライマリ サイトを回復するとき)、または基準プライマリ サイト (中央管理サイトを回復するとき) から取得されます。 スタンドアロンのプライマリ サイトのサイト データベースを回復する場合は、最後のバックアップ以後にサイトに加えられた変更を回復することはできません。  

    > [!NOTE]  
    >  DPM を使用してサイト データベースをバックアップするときに、Configuration Manager で復元プロセスを続行する前に、DPM の手順を使用して指定の場所にサイト データベースを復元します。 DPM の詳細については、TechNet の「 [Data Protection Manager](http://go.microsoft.com/fwlink/?LinkId=272772) 」ドキュメント ライブラリを参照してください。  

-   **データベースの回復をスキップする**: Configuration Manager サイト データベース サーバーのデータが失われていない場合にのみ、このオプションを使用してください。 このオプションは、回復しようとしているサイト サーバーとは別のコンピューターにサイト データベースがある場合だけ選択できます。  

####  <a name="a-namebkmksqlretentiona-sql-server-change-tracking-retention-period"></a><a name="bkmk_SQLretention"></a> SQL Server の変更の追跡の保有期間  
 SQL Server のサイト データベースでは、変更の追跡機能が有効になっています。 そのため、過去のある時点以後にデータベース テーブルに加えられた変更に関する情報を、Configuration Manager が照会することができます。 保有期間とは、この変更の追跡データを残しておく期間のことです。 既定では、サイト データベースの追跡データの保有期間は 5 日に構成されています。 サイト データベースを回復するときは、バックアップがこの保有期間内に作成されたかどうかによって、回復プロセスが異なります。 たとえば、サイト データベースで障害が発生した時点で、最も新しいバックアップが作成後 7 日経過している場合は、保有期間外に作成されていることになります。  

####  <a name="a-namebkmkreinita-process-to-reinitialize-site-or-global-data"></a><a name="bkmk_reinit"></a> サイトのデータまたはグローバル データの再初期化プロセス  
 サイトのデータまたはグローバル データの再初期化とは、サイト データベースにある既存のデータを別のサイト データベースに置き換えるプロセスのことです。 たとえば、"ABC" というサイトのデータを "XYZ" というサイトのデータで再初期化するときは、次の処理が行われます。  

-   サイト "XYZ" からサイト "ABC" にデータがコピーされます。  

-   サイト "ABC" のサイト データベースから、サイト "XYZ" の既存のデータが削除されます。  

-   サイト "XYZ" からコピーされたデータが、サイト "ABC" のサイト データベースに挿入されます。  

##### <a name="example-scenario-1"></a>例 1  
 **プライマリ サイトで、中央管理サイトからグローバル データを再初期化する**: 回復プロセスで、プライマリ サイト データベースにあるプライマリ サイト用グローバル データが削除され、中央管理サイトからコピーされたグローバル データに置き換えられます。  

##### <a name="example-scenario-2"></a>例 2  
 **中央管理サイトで、プライマリ サイトからサイト データを再初期化する**: 回復プロセスで、中央管理サイト データベースにある、該当するプライマリ サイト用サイト データが削除され、そのプライマリ サイトからコピーされたサイト データに置き換えられます。 他のサイト用のサイト データは影響を受けません。  

####  <a name="a-namebkmksitedbrecoveryscenariosa-site-database-recovery-scenarios"></a><a name="BKMK_SiteDBRecoveryScenarios"></a> サイト データベースの回復方法  
 サイト データベースがバックアップから復元されると、Configuration Manager は前回のデータベースのバックアップ以後にサイト データとグローバル データに加えられた変更の回復を試みます。 以下に、サイト データベースがバックアップから復元された後に Configuration Manager で開始される処理について説明します。  

 **回復したサイトが中央管理サイトの場合:**  

-   **データベースが、変更の追跡の保有期間以内にバックアップされている場合**  

    -   **グローバル データ:** バックアップ後のグローバル データの変更は、すべてのプライマリ サイトからレプリケートされます。  

    -   **サイト データ:** バックアップ後のサイト データの変更は、すべてのプライマリ サイトからレプリケートされます。  

-   **データベースが、変更の追跡の保有期間より前にバックアップされている場合**  

    -   **グローバル データ:** 基準プライマリ サイトを指定すると、中央管理サイトは基準プライマリ サイトからのグローバル データを再初期化します。 他のすべてのプライマリ サイトを、中央管理サイトのグローバル データで再初期化します。 基準サイトを指定していない場合は、すべてのプライマリ サイトを、中央管理サイトのグローバル データ (バックアップから復元されたデータ) で再初期化します。  

    -   **サイト データ:** 中央管理サイトは各プライマリ サイトからのサイト データを再初期化します。  

 **回復したサイトがプライマリ サイトの場合:**  

-   **データベースが、変更の追跡の保有期間以内にバックアップされている場合**  

    -   **グローバル データ:** バックアップ後のグローバル データの変更は、中央管理サイトからレプリケートされます。  

    -   **サイト データ:** 中央管理サイトはプライマリ サイトからのサイト データを再初期化します。 バックアップ以後に加えられた変更は失われますが、データの大部分は、プライマリ サイトに情報を送信するクライアントによって、再び生成されます。  

-   **データベースが、変更の追跡の保有期間より前にバックアップされている場合**  

    -   **グローバル データ:** プライマリ サイトは中央管理サイトからのグローバル データを再初期化します。  

    -   **サイト データ:** 中央管理サイトはプライマリ サイトからのサイト データを再初期化します。 バックアップ以後に加えられた変更は失われますが、データの大部分は、プライマリ サイトに情報を送信するクライアントによって、再び生成されます。  

### <a name="site-recovery-procedures"></a>サイトの回復手順  
 次のいずれかの手順に従って、サイト サーバーとサイト データベースを回復します。  

##### <a name="to-start-a-site-recovery-in-the-setup-wizard"></a>セットアップ ウィザードを使ってサイトの回復を開始するには  

1.  Configuration Manager インストール フォルダー外の場所に CD.Latest フォルダーをコピーします (「[System Center Configuration Manager の CD.Latest フォルダー](../../core/servers/manage/the-cd.latest-folder.md)」をご覧ください)。  

     CD.Latest フォルダーのコピーから、Configuration Manager セットアップ ウィザードを実行します。  

2.  [ **はじめに** ] ページで、[ **サイトを回復する**] を選択してから、[ **次へ**] をクリックします。  

3.  表示される指示に従って、順次適切なオプションを選択し、ウィザードを完了します。  

    > [!IMPORTANT]  
    >  サイトの回復中に、セットアップ プログラムによって、SQL Server で使用している SQL Server Service Broker (SSB) のポートが検出されます。 サイトの回復中に、このポートの設定を変更しないでください。変更すると、回復が完了した後で、データが正しくレプリケートされません。  

    > [!NOTE]  
    >  セットアップ ウィザードで Configuration Manager のインストールに使用する元のパスまたは新しいパスを指定できます。  

##### <a name="to-start-an-unattended-site-recovery"></a>サイトの無人回復を開始するには  

1.  サイトを回復するのに必要な無人インストール スクリプトを準備します。  

2.  コマンド **/script** オプションを使用して、Configuration Manager セットアップを実行します。 たとえば、セットアップの初期化ファイルに ConfigMgrUnattend.ini という名前を付けて、Setup コマンドを実行するコンピューターの C:\Temp ディレクトリに保存した場合、コマンドは次のようになります: **Setup /script C:\temp\ConfigMgrUnattend.ini**  

> [!NOTE]  
>  中央管理サイトを回復した後、子サイトからの一部のサイト データのレプリケーションの確立が失敗する場合があります。 これには、ハードウェア インベントリ、ソフトウェア インベントリおよびステータス メッセージが含まれることがあります。  
>   
>  このことが発生した場合は、データベース レプリケーションの **ConfigMgrDRSSiteQueue** を再初期化する必要があります。  このためには、**SQL Server Manager** を使用して、中央管理サイトの Configuration Manager サイト データベースで次のクエリを実行します。  
>   
>  **IF EXISTS (SELECT \* FROM sys.service_queues WHERE name = 'ConfigMgrDRSSiteQueue' AND is_receive_enabled = 0)**  
>   
>  **ALTER QUEUE [dbo].[ConfigMgrDRSSiteQueue] WITH STATUS = ON**  

###  <a name="a-namebkmkunattendedsiterecoverykeysa-unattended-site-recovery-script-file-keys"></a><a name="BKMK_UnattendedSiteRecoveryKeys"></a> サイトの無人回復スクリプト ファイルのキー  
 Configuration Manager の中央管理サイト、またはプライマリ サイトの無人回復を実行するには、無人インストール スクリプトを作成して、Setup コマンドに /script オプションを付けて実行します。 このスクリプトで、セットアップ ウィザードで入力するのと同じ種類の情報を指定します。ただし、既定の設定はありません。 使用する回復方法に該当するセットアップ キーの値をすべて指定する必要があります。  

 Configuration Manager の無人セットアップを実行するには、初期化ファイルと、/script Setup コマンドライン オプションを使用します。 無人セットアップは、Configuration Manager の中央管理サイトとプライマリ サイトの回復でサポートされています。 /script Setup コマンド ライン オプションを使用するには、初期化ファイルを作成して、/script Setup コマンド ライン オプションの後ろに、その初期化ファイル名を入力する必要があります。 .ini という拡張子が付いている限り、ファイル名そのものは重要ではありません。 コマンド ラインでセットアップ初期化ファイルを指定するときは、そのファイルの完全パスを入力する必要があります。 たとえば、C:\setup フォルダーにある setup.ini というセットアップ初期化ファイルを使う場合は、コマンド ラインに次のように入力します。  

 **setup /script c:\setup\setup.ini**にする必要があります。  

> [!IMPORTANT]  
>  Setup コマンドを実行するには、管理者権限が必要です。 必ず、 **[管理者として実行]**を選択してから、コマンド プロンプトを開いてください。  

 スクリプトは、セクション名、キー名、値で構成します。 セクションの必須キーは、スクリプトを記述している回復の種類によって異なります。 セクション内でのキーの順序、およびファイル内でのセクションの順序は重要ではありません。 キー名の大文字と小文字は区別されません。 キーの値を指定するときは、キー名の後ろに等号 (=) 入力してから、キーの値を続けます。  

 次のセクションにある表を、サイトの無人回復用スクリプトを記述するときの参考にしてください。 この表には、スクリプトで指定できるキーとその値、必須かどうかの別、該当するインストールの方法、およびキーの説明が示されています。  

#### <a name="recover-a-central-administration-site-unattended"></a>中央管理サイトの無人回復  
 中央管理サイトを回復するための無人セットアップ用スクリプト ファイルを構成するには、次の情報を使用します。  

 **Identification**  

-   **キー名:** Action  

    -   **必須:** はい  

    -   **値:** RecoverCCAR  

    -   **詳細:** 中央管理サイトを回復します  

 **RecoveryOptions**  

-   **キー名:** ServerRecoveryOptions  

    -   **必須:** はい  

    -   **値** : 1、2、または 4  

         1 = サイト サーバーと SQL Server を回復します。  

         2 = サイト サーバーだけを回復します。  

         4 = SQL Server だけを回復します。  

    -   **詳細:** セットアップでサイト サーバーと SQL Server のどちらか、または両方を回復することを指定します。 ServerRecoveryOptions の設定値によって、関連するキーの設定が異なります。  

        -   **値 = 1** : **SiteServerBackupLocation** キーに値を指定して、サイトのバックアップを使ってサイトを回復することができます。 値を指定しなかった場合は、バックアップを使わずにサイトが再インストールされます。  

             **DatabaseRecoveryOptions** キーを **10** に設定して、バックアップからサイト データベースが復元されるようにした場合は、 **BackupLocation** キーを指定する必要があります。  

        -   **値 = 2** : **SiteServerBackupLocation** キーに値を指定して、サイトのバックアップを使ってサイトを回復することができます。 値を指定しなかった場合は、バックアップを使わずにサイトが再インストールされます。  

        -   **値 = 4** インストールする **BackupLocation** キーを **10** に設定して、バックアップからサイト データベースが復元されるようにした場合は、 **BackupLocation** キーを指定する必要があります。  

-   **キー名:** DatabaseRecoveryOptions  

    -   **必須** : 状況によって異なる  

    -   **値:** 10、20、40、80  

         10 = バックアップからサイト データベースを復元します。  

         20 = 別の方法を使って手動で回復されたサイト データベースを使用します。  

         40 = サイトの新しいデータベースを作成します。 サイト データベースのバックアップがない場合に、このオプションを使用してください。 グローバル データとサイト データは、別のサイトをレプリケートすることによって回復します。  

         80 = データベースの回復をスキップします。  

    -   **詳細:** セットアップで SQL Server のサイト データベースをどのように回復するかを指定します。 このキーは、 **ServerRecoveryOptions** キーを **1** または **4**に設定したときに必要です。  

-   **キー名:** ReferenceSite  

    -   **必須** : 状況によって異なる  

    -   **値:** <ReferenceSiteFQDN\>  

    -   **詳細:** データベースのバックアップが変更の追跡の保有期間より前に作成されているか、バックアップなしでサイトを回復する場合に、中央管理サイトでグローバル データを回復するために使用する基準プライマリ サイトを指定します。  

         バックアップが変更の追跡の保有期間より前に作成されており、基準サイトを指定しなかった場合は、すべてのプライマリ サイトが、中央管理サイトから復元されたデータで再初期化されます。  

         バックアップが変更の追跡の保有期間内に作成されており、基準サイトを指定しなかった場合は、バックアップ作成以後に加えられた変更だけが、プライマリ サイトからレプリケートされます。 プライマリ サイト同士の変更内容が競合している場合は、中央管理サイトで、最初に受け取った変更内容が採用されます。  

         このキーは、 **DatabaseRecoveryOptions** キーを **40**に設定したときに必要です。  

-   **キー名:** SiteServerBackupLocation  

    -   **必須:** いいえ  

    -   **値:** <PathToSiteServerBackupSet\>  

    -   **詳細:** サイト サーバーのバックアップ セットへのパスを指定します。 このキーは、 **ServerRecoveryOptions** キーを **1** か **2**に設定したときにオプションで指定するキーです。 サイトのバックアップを使ってサイトを回復したい場合に、 **SiteServerBackupLocation** キーでバックアップの場所を指定します。 値を指定しなかった場合は、バックアップを使わずにサイトが再インストールされます。  

-   **キー名:** BackupLocation  

    -   **必須** : 状況によって異なる  

    -   **値:** <PathToSiteDatabaseBackupSet\>  

    -   **詳細:** サイト データベースのバックアップ セットへのパスを指定します。 **BackupLocation** キーは、 **ServerRecoveryOptions** キーを **1** か **4** に設定したときに必要です。このキーを指定したときは、 **DatabaseRecoveryOptions** キーを **10** に設定してください。  

 **Options**  

-   **キー名:** ProductID  

    -   **必須:** はい  

    -   **値:**  

         xxxxx-xxxxx-xxxxx-xxxxx-xxxxx  

         評価版  

    -   **詳細:** ダッシュを含む、インストールする Configuration Manager のプロダクト キー。 「**Eval**」と入力することで、Configuration Manager の評価版をインストールできます。  

-   **キー名:** SiteCode  

    -   **必須:** はい  

    -   **値:** <Site code\>  

    -   **詳細:** 階層内のサイトを一意に識別する英数字 3 文字。 障害が発生する前にサイトに付いていたサイト コードを指定する必要があります。  

-   **キー名:** SiteName  

    -   **必須:** はい  

    -   **値:** SiteName  

    -   **詳細:** このサイトの説明。  

-   **キー名:** SMSInstallDir  

    -   **必須:** はい  

    -   **値:** <*ConfigMgrInstallationPath*>  

    -   **詳細:** Configuration Manager のプログラム ファイルのインストール フォルダーを指定します。  

        > [!NOTE]  
        >  Configuration Manager のインストールに使用する元のパスまたは新しいパスを指定できます。  

-   **キー名:** SDKServer  

    -   **必須:** はい  

    -   **値:** <*FQDN of SMS Provider*>  

    -   **詳細:** SMS プロバイダーをホストするサーバーの FQDN を指定します。 障害が発生する前に SMS プロバイダーをホストしていたサーバーを指定する必要があります。  

         初期インストールが終わった後で、他の SMS プロバイダーを追加して構成することができます。  

-   **キー名:** PrerequisiteComp  

    -   **必須:** はい  

    -   **値:** 0 または 1  

         0 = ダウンロードします。  

         1 = 既にダウンロードされています。  

    -   **詳細:** セットアップの前提条件ファイルが既にダウンロード済みかどうかを指定します。 この値を 0 に設定すると、セットアップ時にファイルがダウンロードされます。  

-   **キー名:** PrerequisitePath  

    -   **必須:** はい  

    -   **値:** <*PathToSetupPrerequisiteFiles*>  

    -   **詳細:** セットアップの前提条件ファイルのパスを指定します。 このパスは、 **PrerequisiteComp** キーに設定した値に応じて、ダウンロードしたファイルを保存するか、ダウンロード済みのファイルを見つけるために使われます。  

-   **キー名:** AdminConsole  

    -   **必須** : 状況によって異なる  

    -   **値:** 0 または 1  

         0 = インストールしません。  

         1 = インストールします。  

    -   **詳細:** Configuration Manager コンソールをインストールするかどうかを指定します。 このキーは、 **ServerRecoveryOptions** キーを **4**以外の値に設定した場合に必要です。  

-   **キー名:** JoinCEIP  

    -   **必須:** はい  

    -   **値:** 0 または 1  

         0 = 参加しません。  

         1 = 参加します。  

    -   **詳細:** カスタマー エクスペリエンス向上プログラムに参加するかどうかを指定します。  

 **SQLConfigOptions**  

-   **キー名:** SQLServerName  

    -   **必須:** はい  

    -   **値:** *<SQLServerName\>*  

    -   **詳細:** サイト データベースをホストする SQL Server を実行しているサーバー、またはクラスター化されている場合はインスタンス名。 障害が発生する前にサイト データベースをホストしていたサーバーを指定する必要があります。  

-   **キー名:** DatabaseName  

    -   **必須:** はい  

    -   **値:**  

         *&lt;SiteDatabaseName\>*  

         ] ダイアログ ボックスの [  

         *<InstanceName\>*\\*<SiteDatabaseName\>*  

    -   **詳細:** 中央管理サイト データベースをインストールするために作成または使用する SQL Server データベースの名前。 障害が発生する前に使用していたデータベース名と同じ名前を指定する必要があります。  

        > [!IMPORTANT]  
        >  既定のインスタンスを使用しない場合は、必ず、インスタンス名とサイト データベース名を指定してください。  

-   **キー名:** SQLSSBPort  

    -   **必須:** いいえ  

    -   **値:** <*SSBPortNumber*>  

    -   **詳細:** SQL Server で使用する SQL Server Service Broker (SSB) のポート番号を指定します。 通常、TCP ポート 4022 に構成しますが、別のポートもサポートされています。 障害が発生する前に使用していた SSB ポート番号と同じ番号を指定する必要があります。  

#### <a name="recover-a-primary-site-unattended"></a>プライマリ サイトの無人回復  
 中央管理サイトを回復するための無人セットアップ用スクリプト ファイルを構成するには、次の情報を使用します。  

 **Identification**  

-   **キー名:** Action  

    -   **必須:** はい  

    -   **値:** RecoverPrimarySite  

    -   **詳細:** プライマリ サイトを回復します  

 **RecoveryOptions**  

-   **キー名:** ServerRecoveryOptions  

    -   **必須:** はい  

    -   **値** : 1、2、または 4  

         1 = サイト サーバーと SQL Server を回復します。  

         2 = サイト サーバーだけを回復します。  

         4 = SQL Server だけを回復します。  

    -   **詳細:** セットアップでサイト サーバーと SQL Server のどちらか、または両方を回復することを指定します。 ServerRecoveryOptions の設定値によって、関連するキーの設定が異なります。  

        -   **値 = 1** : **SiteServerBackupLocation** キーに値を指定して、サイトのバックアップを使ってサイトを回復することができます。 値を指定しなかった場合は、バックアップを使わずにサイトが再インストールされます。  

             **DatabaseRecoveryOptions** キーを **10** に設定して、バックアップからサイト データベースが復元されるようにした場合は、 **BackupLocation** キーを指定する必要があります。  

        -   **値 = 2** : **SiteServerBackupLocation** キーに値を指定して、サイトのバックアップを使ってサイトを回復することができます。 値を指定しなかった場合は、バックアップを使わずにサイトが再インストールされます。  

        -   **値 = 4** インストールする **BackupLocation** キーを **10** に設定して、バックアップからサイト データベースが復元されるようにした場合は、 **BackupLocation** キーを指定する必要があります。  

-   **キー名:** DatabaseRecoveryOptions  

    -   **必須** : 状況によって異なる  

    -   **値:** 10、20、40、80  

         10 = バックアップからサイト データベースを復元します。  

         20 = 別の方法を使って手動で回復されたサイト データベースを使用します。  

         40 = サイトの新しいデータベースを作成します。 サイト データベースのバックアップがない場合に、このオプションを使用してください。 グローバル データとサイト データは、別のサイトをレプリケートすることによって回復します。  

         80 = データベースの回復をスキップします。  

    -   **詳細:** セットアップで SQL Server のサイト データベースをどのように回復するかを指定します。 このキーは、 **ServerRecoveryOptions** キーを **1** または **4**に設定したときに必要です。  

-   **キー名:** SiteServerBackupLocation  

    -   **必須:** いいえ  

    -   **値:** <PathToSiteServerBackupSet\>  

    -   **詳細:** サイト サーバーのバックアップ セットへのパスを指定します。 このキーは、 **ServerRecoveryOptions** キーを **1** か **2**に設定したときにオプションで指定するキーです。 サイトのバックアップを使ってサイトを回復したい場合に、 **SiteServerBackupLocation** キーでバックアップの場所を指定します。 値を指定しなかった場合は、バックアップを使わずにサイトが再インストールされます。  

-   **キー名:** BackupLocation  

    -   **必須** : 状況によって異なる  

    -   **値:** <PathToSiteDatabaseBackupSet\>  

    -   **詳細:** サイト データベースのバックアップ セットへのパスを指定します。 **BackupLocation** キーは、 **ServerRecoveryOptions** キーを **1** か **4** に設定したときに必要です。このキーを指定したときは、 **DatabaseRecoveryOptions** キーを **10** に設定してください。  

 **Options**  

-   **キー名:** ProductID  

    -   **必須:** はい  

    -   **値:**  

         xxxxx-xxxxx-xxxxx-xxxxx-xxxxx  

         評価版  

    -   **詳細:** ダッシュを含む、インストールする Configuration Manager のプロダクト キー。 「**Eval**」と入力することで、Configuration Manager の評価版をインストールできます。  

-   **キー名:** SiteCode  

    -   **必須:** はい  

    -   **値:** <Site code\>  

    -   **詳細:** 階層内のサイトを一意に識別する英数字 3 文字。 障害が発生する前にサイトに付いていたサイト コードを指定する必要があります。  

-   **キー名:** SiteName  

    -   **必須:** はい  

    -   **値:** SiteName  

    -   **詳細:** このサイトの説明。  

-   **キー名:** SMSInstallDir  

    -   **必須:** はい  

    -   **値:** <*ConfigMgrInstallationPath*>  

    -   **詳細:** Configuration Manager のプログラム ファイルのインストール フォルダーを指定します。  

        > [!NOTE]  
        >  Configuration Manager のインストールに使用する元のパスまたは新しいパスを指定できます。  

-   **キー名:** SDKServer  

    -   **必須:** はい  

    -   **値:** <*FQDN of SMS Provider*>  

    -   **詳細:** SMS プロバイダーをホストするサーバーの FQDN を指定します。 障害が発生する前に SMS プロバイダーをホストしていたサーバーを指定する必要があります。  

         初期インストールが終わった後で、他の SMS プロバイダーを追加して構成することができます。  

-   **キー名:** PrerequisiteComp  

    -   **必須:** はい  

    -   **値:** 0 または 1  

         0 = ダウンロードします。  

         1 = 既にダウンロードされています。  

    -   **詳細:** セットアップの前提条件ファイルが既にダウンロード済みかどうかを指定します。 この値を 0 に設定すると、セットアップ時にファイルがダウンロードされます。  

-   **キー名:** PrerequisitePath  

    -   **必須:** はい  

    -   **値:** <*PathToSetupPrerequisiteFiles*>  

    -   **詳細:** セットアップの前提条件ファイルのパスを指定します。 このパスは、 **PrerequisiteComp** キーに設定した値に応じて、ダウンロードしたファイルを保存するか、ダウンロード済みのファイルを見つけるために使われます。  

-   **キー名:** AdminConsole  

    -   **必須** : 状況によって異なる  

    -   **値:** 0 または 1  

         0 = インストールしません。  

         1 = インストールします。  

    -   **詳細:** Configuration Manager コンソールをインストールするかどうかを指定します。 このキーは、 **ServerRecoveryOptions** キーを **4**以外の値に設定した場合に必要です。  

-   **キー名:** JoinCEIP  

    -   **必須:** はい  

    -   **値:** 0 または 1  

         0 = 参加しません。  

         1 = 参加します。  

    -   **詳細:** カスタマー エクスペリエンス向上プログラムに参加するかどうかを指定します。  

 **SQLConfigOptions**  

-   **キー名:** SQLServerName  

    -   **必須:** はい  

    -   **値:** *<SQLServerName\>*  

    -   **詳細:** サイト データベースをホストする SQL Server を実行しているサーバー、またはクラスター化されている場合はインスタンス名。 障害が発生する前にサイト データベースをホストしていたサーバーを指定する必要があります。  

-   **キー名:** DatabaseName  

    -   **必須:** はい  

    -   **値:**  

         *&lt;SiteDatabaseName\>*  

         ] ダイアログ ボックスの [  

         *<InstanceName\>*\\*<SiteDatabaseName\>*  

    -   **詳細:** 中央管理サイト データベースをインストールするために作成または使用する SQL Server データベースの名前。 障害が発生する前に使用していたデータベース名と同じ名前を指定する必要があります。  

        > [!IMPORTANT]  
        >  既定のインスタンスを使用しない場合は、必ず、インスタンス名とサイト データベース名を指定してください。  

-   **キー名:** SQLSSBPort  

    -   **必須:** いいえ  

    -   **値:** <*SSBPortNumber*>  

    -   **詳細:** SQL Server で使用する SQL Server Service Broker (SSB) のポート番号を指定します。 通常、TCP ポート 4022 に構成しますが、別のポートもサポートされています。 障害が発生する前に使用していた SSB ポート番号と同じ番号を指定する必要があります。  

 **Hierarchy ExpansionOption**  

-   **キー名:** CCARSiteServer  

    -   **必須** : 状況によって異なる  

    -   **値:** <*SiteCodeForCentralAdministrationSite*>  

    -   **詳細:** プライマリ サイトを Configuration Manager 階層に含めるときに、アタッチする中央管理サイトを指定します。 障害が発生する前にプライマリ サイトが中央管理サイトにアタッチされていた場合は、この設定が必要です。 障害が発生する前に中央管理サイトに付いていたサイト コードを指定する必要があります。  

-   **キー名:** CASRetryInterval  

    -   **必須:** いいえ  

    -   **値:** <*Interval*>  

    -   **詳細:** 中央管理サイトとの接続が切断されたときに、接続を再試行する間隔 (分) を指定します。 たとえば、プライマリ サイトと中央管理サイトの接続が切断されると、プライマリ サイトは、このキーで指定された時間だけ待ってから、もう一度接続しようとします。  

-   **キー名:** WaitForCASTimeout  

    -   **必須:** いいえ  

    -   **値:** <*Timeout*>  

    -   **詳細:** プライマリ サイトから中央管理サイトに接続するときのタイムアウトの最大値 (分) を指定します。 たとえば、プライマリ サイトから中央管理サイトに接続できなかった場合は、プライマリ サイトは、WaitForCASTimeout キーで指定された時間が経過するまで、CASRetryInterval キーの値に従って、中央管理サイトとの接続を再試行します。 0 ～ 100 に指定できます。  

###  <a name="a-namebkmkpostrecoverya-post-recovery-tasks"></a><a name="BKMK_PostRecovery"></a> 回復後の作業  
 サイトを回復した後で行わなければならない作業がいくつかあります。 次のセクションの情報を、サイトの回復プロセスを完了させるときの参考にしてください。  

#### <a name="re-enter-user-account-passwords"></a>ユーザー アカウントのパスワードを再入力する  
 サイト サーバーの回復が終わったら、そのサイトに指定していたユーザー アカウントのパスワードを再入力する必要があります。これは、サイトの回復中にパスワードがリセットされるためです。 これらのアカウントは、サイトの回復が終わったときに、セットアップ ウィザードの **[完了]** ページに一覧され、回復したサイト サーバーの C:\ConfigMgrPostRecoveryActions.html に保存されます。  

###### <a name="to-re-enter-user-account-passwords-after-site-recovery"></a>サイトの回復後にユーザー アカウントのパスワードを再入力するには  

1.  Configuration Manager コンソールを開き、回復したサイトに接続します。  

2.  Configuration Manager コンソールで、[ **管理**] をクリックします。  

3.  [ **管理** ] ワークスペースで、[ **セキュリティ**] を展開してから、[ **アカウント**] をクリックします。  

4.  パスワードを入力する必要のあるアカウントごとに、次の操作を行います。  

    1.  サイトの回復が終わったときに保存されたアカウントの一覧で、アカウントを選択します。 この一覧は、回復したサイト サーバーの C:\ConfigMgrPostRecoveryActions.html にあります。  

    2.  [ **ホーム** ] タブの [ **プロパティ** ] グループで、[ **プロパティ** ] をクリックしてアカウントのプロパティを開きます。  

    3.  [ **全般** ] タブで、[ **設定**] をクリックしてから、アカウントのパスワードを再入力します。  

    4.  [ **確認**] をクリックし、選択したユーザー アカウントの適切なデータ ソースを選択します。[ **接続のテスト** ] をクリックして、そのユーザー アカウントでデータ ソースに接続できるかどうかを確認します。  

    5.  [ **OK** ] をクリックしてパスワードの変更を保存してから、[ **OK**] をクリックします。  

#### <a name="re-enter-sideloading-keys"></a>サイドローディング キーの再入力  
 サイト サーバーの回復が終わったら、そのサイトに指定していた Windows サイドローディング キーを再入力する必要があります。これは、サイトの回復中にサイドローディング キーがリセットされるためです。 サイドローディング キーを再入力すると、Configuration Manager コンソールで Windows サイドローディング キーの **[使用済みライセンス認証数]** 列内のカウントがリセットされます。 たとえば、サイト エラーが発生する前に、**[合計ライセンス認証数]** カウントが **100** に設定され、**[使用済みライセンス認証数]** がデバイスで使用されていたキーの数に相当する **90** になっていたとします。 サイトの回復後、[ **合計ライセンス認証数** ] 列には **100**と表示されますが、[ **使用済みライセンス認証数** ] 列には誤って **0**と表示されます。 しかし、新しく 10 台のデバイスがサイドローディング キーを使用すると、ライセンスの残りがなくなってしまうので、11 台目以降、キーを取得できなくなります。  

#### <a name="recreate-the-microsoft-intune-subscription"></a>Microsoft Intune サブスクリプションの再作成  
 サイト サーバー コンピューターが再イメージ化された後に Configuration Manager サイト サーバーを回復する場合、Microsoft Intune のサブスクリプションは復元されません。 サイトを回復した後、サブスクリプションを再作成する必要があります。 詳細については、「 [Configuring the Microsoft Intune subscription](../../mdm/plan-design/hybrid-mobile-device-management.md#bkmk_witsub)」をご覧ください。  

#### <a name="configure-ssl-for-site-system-roles-that-use-iis"></a>IIS を使用するサイト システムの役割の SSL を構成する  
 IIS を実行するサイト システムを回復し、障害が発生する前に、そのシステムが HTTPS 接続用に構成されていた場合は、IIS で Web サーバー証明書を使用するように再構成する必要があります。  

#### <a name="reinstall-hotfixes-in-the-recovered-site-server"></a>回復したサイト サーバーに修正プログラムを再インストールする  
 サイトの回復が終わったら、障害が発生する前にサイト サーバーに適用されていた修正プログラムを再インストールする必要があります。 これらの修正プログラムは、サイトの回復が終わったときに、セットアップ ウィザードの **[完了]** ページに一覧され、回復したサイト サーバーの **C:\ConfigMgrPostRecoveryActions.html** に保存されます。  

#### <a name="recover-custom-reports-on-the-computer-running-reporting-services"></a>Reporting Services を実行しているコンピューターで使用していたカスタム レポートを復元する  
 Reporting Services で障害が発生する前に、Reporting Services のカスタム レポートを作成していた場合は、レポート サーバーのバックアップ (存在する場合) から、カスタム レポートを復元することができます。 Reporting Services のカスタム レポートの復元の詳細については、SQL Server 2008 Books Online の「 [Reporting Services インストールのバックアップおよび復元操作](http://go.microsoft.com/fwlink/p/?LinkId=228724) 」を参照してください。  

#### <a name="recover-content-files"></a>コンテンツ ファイルを回復する  
 サイト データベースには、サイト サーバーでのコンテンツ ファイルの保存場所に関する情報が含まれていますが、コンテンツ ファイル自体は、バックアップと復元プロセスで、バックアップも復元もされません。 コンテンツ ファイルを完全に回復するには、コンテンツ ライブラリのファイルとパッケージ ソース ファイルを元の場所に復元する必要があります。 コンテンツ ファイルを回復する方法はいくつかありますが、一番簡単なのは、サイト サーバーのファイル システムのバックアップからファイルを復元する方法です。  

 パッケージ ソース ファイル復元用のファイル システムのバックアップがない場合は、最初にパッケージを作成したときと同じようにして、ファイルを手動でコピーしたりダウンロードしたりする必要があります。 すべてのパッケージとアプリケーションのパッケージ ソースの場所を見つけるには、SQL Server で `SELECT * FROM v_Package`というクエリを実行します。 パッケージ ID の先頭の 3 文字を見ると、パッケージ ソースのサイトがわかります。 たとえば、CEN00001 というパッケージ ID では、CEN がソース サイトのサイト コードです。 パッケージのソース ファイルを復元するときは、障害発生前と同じ場所に復元する必要があります。  

 コンテンツ ライブラリが含まれているファイル システムのバックアップがない場合は、次の方法でコンテンツ ファイルを復元できます。  

-   **事前設定済みのコンテンツ ファイルをインポートする**: Configuration Manager 階層がある場合は、別の場所にあるすべてのパッケージとアプリケーションの事前設定済みコンテンツ ファイルを作成し、そのファイルをインポートして、サイト サーバーのコンテンツ ライブラリを回復できます。  

-   **コンテンツを更新する**: パッケージまたはアプリケーションの展開の種類のコンテンツの更新操作を開始すると、コンテンツがパッケージ ソースからコンテンツ ライブラリにコピーされます。 この処理が正常に完了するには、パッケージ ソース ファイルが元の場所になければなりません。 回復したいパッケージとアプリケーションごとに、コンテンツの更新操作を行う必要があります。  

#### <a name="recover-custom-software-updates-on-the-computer-running-updates-publisher"></a>Updates Publisher を実行していたコンピューターのカスタム ソフトウェア更新プログラムを回復する  
 Updates Publisher データベース ファイルをバックアップ計画に含めていた場合は、Updates Publisher を実行していたコンピューターで障害が発生したときに、そのデータベースを回復できます。 Updates Publisher の詳細については、System Center TechCenter ライブラリの「 [System Center Updates Publisher 2011](http://go.microsoft.com/fwlink/p/?LinkId=228726) 」を参照してください。  

 次の手順に従って、Updates Publisher データベースを復元します。  

###### <a name="to-restore-the-updates-publisher-2011-database"></a>Updates Publisher 2011 データベースを復元するには  

1.  回復したコンピューターに Updates Publisher を再インストールします。  

2.  バックアップしていたデータベース ファイル (Scupdb.sdf) を、Updates Publisher を実行するコンピューターの %*USERPROFILE*%\AppData\Local\Microsoft\System Center Updates Publisher 2011\5.00.1727.0000\ にコピーします。  

3.  コンピューターで複数のユーザーが Updates Publisher を実行する場合は、それぞれのユーザー プロファイルの適切な場所に、データベース ファイルをコピーする必要があります。  

#### <a name="user-state-migration-data"></a>ユーザー状態の移行データ  
 状態移行ポイントのサイト システムのプロパティを設定するときに、ユーザー状態の移行データを保存するフォルダーを指定しています。 ユーザー状態の移行データを保存するフォルダーのあるサーバーを回復したら、障害発生前にデータを保存していたフォルダーと同じフォルダーに、ユーザー状態の移行データを手動で復元する必要があります。  

#### <a name="regenerate-the-certificates-for-distribution-points"></a>配布ポイント用の証明書の再生成  
 サイトの復元後には、1 つまたは複数の配布ポイントに対する **cert PFX データを解読できませんでした**というエントリが distmgr.log に含まれていることがあります。 このエントリは、配布ポイントの証明書データをサイトで解読できないことを示します。 この問題を解決するには、影響を受ける配布ポイントの証明書を再生成または再インポートする必要があります。 それには [Set-CMDistributionPoint](https://technet.microsoft.com/library/jj821872\(v=sc.20\).aspx) PowerShell コマンドレットを使用します。  

#### <a name="update-certificates-used-for-cloud-based-distribution-points"></a>クラウドベースの配布ポイントに使用する証明書の更新  
 Configuration Manager では、サイト サーバーからクラウドベースの配布ポイントへの通信に使用する管理証明書が必要です。 サイトの回復後に、クラウドベースの配布ポイントの証明書を更新する必要があります。  

####  <a name="a-namebkmkrecoversecondarysitea-recover-a-secondary-site"></a><a name="BKMK_RecoverSecondarySite"></a> セカンダリ サイトの回復  
 Configuration Manager はセカンダリ サイトのデータベースのバックアップをサポートしていませんが、セカンダリ サイトの再インストールによる回復はサポートしています。 セカンダリ サイトの回復は、Configuration Manager セカンダリ サイトで障害が発生した場合に必要になります。 Configuration Manager コンソールの **[サイト]** ノードから、**[セカンダリ サイトの回復]** アクションを使用してセカンダリ サイトを回復することができます。 中央管理サイトまたはプライマリ サイトの回復とは異なり、セカンダリ サイトの回復ではバックアップ ファイルを使用せず、代わりに障害が発生したセカンダリ サイトのコンピューターにセカンダリ サイトのファイルを再インストールします。 次に、セカンダリ サイトのデータが、親プライマリ サイトからのデータで再初期化されます。 回復プロセスで、Configuration Manager は、セカンダリ サイトのコンピューターにコンテンツ ライブラリが存在することと、適切なコンテンツが使用できることを確認します。 適切なコンテンツが含まれている場合、セカンダリ サイトでは、既存のコンテンツ ライブラリが使用されます。 それ以外の場合、回復したセカンダリ サイトのコンテンツ ライブラリを回復するには、回復したサイトにコンテンツを再配布するかまたは事前設定する必要があります。 使用する配布ポイントがセカンダリ サイトに存在するのではない場合は、セカンダリ サイトの回復中に配布ポイントを再インストールする必要はありません。 セカンダリ サイトの回復後に、サイトが配布ポイントと自動的に同期されます。  

 Configuration Manager コンソールの **[サイト]** ノードから **[インストール ステータスの表示]** アクションを使用して、セカンダリ サイトの回復のステータスを確認することができます。  

> [!IMPORTANT]  
>  セカンダリ サイトを適切に回復するには、障害が発生したコンピューターと同じ構成 (FQDN など) のコンピューターを使用する必要があります。 コンピューターがセカンダリ サイトのすべての前提条件を満たしており、適切なセキュリティ権限が構成されていることも必要です。 また、障害が発生したサイトに使用したのと同じインストール パスを使用してください。  

> [!IMPORTANT]  
>  コンピューターに SQL Server Express がインストールされていない場合、セカンダリ サイトの回復中に Configuration Manager によってインストールされません。 そのため、セカンダリ サイトを回復する前に、SQL Server Express または SQL Server を手動でインストールする必要があります。 障害が発生する前にセカンダリ サイト データベースで使用していたのと同じバージョンの SQL Server および同じ SQL Server インスタンスを使用する必要があります。  

##  <a name="a-namebkmksmswriterservicea-sms-writer-service"></a><a name="BKMK_SMSWriterService"></a> SMS ライター サービス  
 SMS ライターは、バックアップ中にボリューム シャドー コピー サービス (VSS) と相互に動作するサービスです。 Configuration Manager サイトのバックアップを正常に完了するには、SMS ライター サービスが実行されていなければなりません。  

### <a name="purpose"></a>目的  
 SMS ライターは、VSS に登録して、そのインターフェイスとイベントをバインドします。 VSS がイベントをブロードキャストするか、SMS ライターに特定の通知を送信すると、SMS ライターは、その通知に応答して適切な措置を取ります。 SMS ライターは、<*<ConfigMgr のインストール先フォルダー>*>\inboxes\smsbkup.box にあるバックアップ コントロール ファイル (smsbkup.ctl) を読み取って、バックアップするファイルとデータを確認します。 次に、この情報、および、SMS レジストリ キーとサブキーの特定のデータに基づいて、さまざまなコンポーネントからなるメタデータを構築します。 SMS ライターは、このデータが要求されたときに VSS に送信します。 次に、VSS が、要求元のアプリケーション、つまり、Configuration Manager バックアップ マネージャーにこのメタデータを送信します。 バックアップ マネージャーは、バックアップするデータを選択し、そのデータを VSS 経由で SMS ライターに送信します。 SMS ライターは、バックアップを開始するのに必要な処理を行います。 その後、VSS がスナップショットを撮る準備ができたら、イベントを送信します。SMS ライターは、スナップショットが作成されている間は、Configuration Manager のすべてのサービスを停止して、Configuration Manager の動作を止めます。 スナップショットの作成が終わったら、SMS ライターが、停止していたサービスを再開します。  

 SMS ライター サービスは自動的にインストールされます。 VSS アプリケーションがバックアップまたは復元を要求したときに、このサービスが実行されていなければなりません。  

### <a name="writer-id"></a>ライター ID  
 SMS ライターの ID は、03ba67dd-dc6d-4729-a038-251f7018463b です。  

### <a name="permissions"></a>アクセス許可  
 SMS ライターは、ローカル システム アカウントで実行する必要があります。  

### <a name="volume-shadow-copy-service"></a>ボリューム シャドウ コピー サービス  
 VSS は、システムのアプリケーションがボリュームに書き込んでいる間にボリュームをバックアップできるようにするフレームワークを実装する COM API のセットです。 VSS は、ディスクのデータを更新するユーザー アプリケーション (SMS ライター サービス) と、アプリケーションのバックアップを取るユーザー アプリケーション (Backup Manager サービス) を連携させるインターフェイスとして機能します。 VSS の詳細については、Windows Server TechCenter の「 [Volume Shadow Copy Service (ボリューム シャドウ コピー サービス)](http://go.microsoft.com/fwlink/p/?LinkId=241968) 」を参照してください。  



<!--HONumber=Nov16_HO1-->


